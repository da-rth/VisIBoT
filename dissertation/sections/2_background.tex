% Checked with Grammarly - 21/03/2021

% Proof Read

\chapter{Background}

\section{The evolution of Botnets}

The earliest of botnets are believed to have originated from back-door concepts first seen in computer viruses discovered in 1999: the Sub7 Trojan and the Pretty Park Worm. By exploiting the IRC protocol, these viruses established the notion of sending execution commands, disguised as legitimate IRC messages, to remotely infected hosts through using an IRC server as a back door. This discovery ultimately led to a substantial growth in malware which propagates and coordinates with infected computer networks using the IRC protocol, sparking the development of complex network infrastructures of infected 'bot' devices, now known as botnets. \citep{Ferguson2010}

According to \citet{Schiller2007}, one of the first IRC botnets was 'Global Threat' (GT), a worm-like malware that manipulates the IRC communication protocol for centralised botnet communication. Upon infecting a computer system, the infected device would remotely connect to a central IRC server used for Command \& Control, waiting to receive message-based attack commands through an IRC client. The IRC protocol proved advantageous for botnet owners, as traffic could be hidden in plain sight through having bots connect to legitimate IRC servers and await commands from a Command \& Control channel. Over time, the concept of centralised IRC communication led to the development of several other notorious botnets, such as the MaXiTE IRC botnet. Botnet owners could control infected bots by sending various types of commands, including port scanning, password sniffing, and attack commands. However, authorities were eventually able to detect IRC botnet activity through intrusion detection, binary analysis, and network traffic monitoring, as IRC commands were often sent as plain text. As IRC botnet malware is hard-coded to connect to a specific IP address and port, authorities could shut down offending IRC servers by inspecting collected malware binaries and suspicious network traffic. As the central point of communication would be taken down, infected bots would be rendered useless unless re-infected with different malware.

Given the various shortcomings of IRC-based botnet communication, botnet developers began to employ other protocols and application layer services as a means of communication, such as the now extremely popular HyperText Transfer Protocol (HTTP) and Domain Name Service (DNS) protocols. In particular, botnets, phishing websites, and other malware distributors began to exploit the DNS protocol using 'Fast Flux' domains. A Fast Flux DNS enables C2 servers to "hide behind an ever-changing network of compromised hosts" \citep{Morton2017}, acting as a network of proxy servers. The random IP addresses returned when querying a Fast-Flux DNS presents significant challenges for botnet mitigation. Fast-Flux Command \& Control servers are masked behind complex proxy networks, making them significantly more challenging to identify. According to \citet{Morton2017}, the Storm botnet is one of the first botnets to mask remote servers behind using Fast Flux DNS. However, the Storm botnet is also known as one of the first-ever de-centralised botnets using standard Peer-to-Peer communication protocols. Early iterations of the Storm botnet, deployed in 2007, used OVERNET, a Peer-to-Peer distributed hash table (DHT) routing protocol, which bots used to find other bots and receive commands through a Peer-to-Peer network. \citep{Holz2008} This transition from centralised to de-centralised communication is said to have marked a significant point in the evolution of botnets, as botnets can be controlled without the concern of deployment and obfuscation factors presented when using a central C2 server.

\citet{ElDefrawy2007} discuss how malicious actors could exploit standard P2P protocols such as BitTorrent to allow for de-centralised botnets and the coordination of large-scale DDoS attacks via peer-to-peer networks. As all bit-torrent clients rely on interacting with trackers, one possible exploit includes disguising a target DDoS victim as a bit-torrent tracker, generating a highly distributed attack using connected P2P nodes. An alternative exploit identified by \citet{ElDefrawy2007} is that BitTorrent Distributed Hash Tables (DHTs) can be used to coordinate botnet attacks on a victim IP address through botnet owners pinging a DHT with a target IP address, which bots will then target. 

Published anonymously due to potentially unethical and potentially illegal experimentation, the \textit{Internet Census 2012} \citep{Cencus2012} is perhaps one of the first papers to discuss the insecurities of IoT devices within the context of botnet propagation. The findings in this paper discovered that a significant number of IoT devices were vulnerable to unauthorised remote access by attempting to log in using common factory-set usernames and passwords created by manufacturers. Following this discovery, the author developed Carna - a distributed port-scanning framework used for botnet propagation. By infecting select vulnerable devices with a port-scanning binary, infected devices would scan other vulnerable machines over the telnet protocol using various scanning tools and methods. This activity ultimately led to the identification of 1.3 billion in-use IP addresses. Additionally, the Carna botnet expanded to over 420,000 vulnerable devices, marking a new and highly effective propagation technique for botnet developers to employ.


% =========================================================================================


\section{An overview of IoT Botnets}

Shortly after the anonymous release of the Internet Census 2012, a new botnet variation began to surface known as Aidra (Lightaidra). \citep{AidraSource} The Aidra botnet targeted a diverse set of operating systems and CPU architectures common to IoT devices. First discovered in January of 2012 by ATMA.ES \citep{ATMA2012}, security researchers observed a substantially high number of telnet attacks originating from various ARM-based IoT devices. \citep{NJCCIC2016} Despite only ARM-based IoT devices being targeted, researchers later discovered that the Aidra source code could also be compiled to several other architectures MIPS, MIPSel, PPC, x86/x86-64, and SuperH. Like the Carna botnet, Aidra could propagate through the port-scanning of vulnerable IoT devices using the telnet protocol. Once identified, the botnet would attempt to infect devices through brute-forcing techniques using known login credentials and Remote Code Execution (RCE). By remotely injecting code via malicious GET/POST requests, the injected code will attempt to download and execute a malware binary to give botnet owners control of the device. Like previous botnets, the Aidra botnet uses the IRC communication protocol as a back-door, such that infected devices connect to a central IRC C2 server and await new commands from the botnet owner. However, as IoT devices often span across various CPU architectures, the command-line injection code will attempt to download and execute all architecture variations of the Aidra malware binary from a remote Payload server.

Bashlite, also known as Gafgyt, LizardStresser, Qbot and Torlus, \citep{NHS2018} is another early IoT botnet that was first identified in 2014. The malware was observed to be targeting a particular group of IoT devices, mainly consisting of routers. The first iteration of the Bashlite botnet initially targeted several router devices running outdated operating systems to exploit a GNU Bash vulnerability known as ShellShock. \citep{Kovacs2014} This vulnerability inadvertently allowed for the processing of trailing strings after function definitions in the values of environment variables, enabling attackers to use this exploit to execute arbitrary code through the likes of remote code/command-line injection. \citep{CVE20146271} All scanning activity is controlled by the C2 server through sending commands to infected bots. \citet{Marzano2018} Upon receiving a scan command, a bot will begin to randomly scan SSH and Telnet ports for vulnerable devices and report potential targets to a loader server. The loader server will attempt to login to the device via SSH or Telnet protocols through brute-forcing commonly used passwords. Once the server gains unauthorised access, it will download, execute, and infect the device with a botnet malware binary. Like conventional IRC botnets, the IP address and port of the C2 server were often hard-coded within the binary to allow infected bots to perform a handshake with a C2 server upon being infected. Bashlite's command distribution functionality allows a bot owner to perform various attacks, including DDoS, TCP Flood, and SYN Flood attacks. These commands are typically unencrypted and sent from a C2 server as plain text. Additional functionality includes distributing binary updates using management commands, collecting statistical information on a botnet using query commands, and stopping ongoing attacks using interrupt commands.

First identified in 2016 by \citet{Malwaremustdie2016}, the Mirai botnet improves upon Bashlite in several respects. \citep{Marzano2018} The most considerable change proposed by the Mirai botnet was the brute-forcing of a broader range of potential target IoT devices, including DVRs, routers, and IP Cameras. Due to the infection of non-conventional devices, it is proposed that the reason for the lack of detection was due to difficulties detecting and extracting IoT malware samples from embedded devices. \citep{Malwaremustdie2016}. Conventional botnet honeypots could not detect Mirai intrusion attempts, as uncommon ports, vulnerabilities, and device architectures are targeted during propagation. The lack of detection for IoT intrusions caused Mirai botnet growth to go unnoticed for a significant duration. In a study by \citet{Marzano2018}, several differences between Mirai and Bashlite were observed. Mirai similarly employs telnet port-scanning and login credential brute-forcing techniques for botnet propagation. 

Unlike Bashlite, the Mirai botnet utilised an extensive collection of password dictionaries containing known IoT device login credentials, supplementing a broader range of devices to target, including IP Cameras and DVRs, routers, and baby monitors. In contrast to Bashlite, Mirai Command \& Control servers are limited to the exclusive distribution of attack commands. All port-scanning activity is automatically performed by infected bots, emitting the distribution of C2 port-scanning commands. When a device is infected with Mirai, the binary will execute code that blocks access to ports commonly used for infection, such as 23 and 2323, and actively removes competitor botnet malware to prevent future re-infection. Mirai also utilises DNS-based botnet communication, alleviating the use of hard-coded IP address and ports common to Bashlite variants. DNS allows for quick and easy hot-swapping of C2 server IP addresses using DNS name records. Should a C2 server be taken down by authorities, the botnet owner can change the IP address. As the Mirai botnet communicates through a C2 server masked behind a domain instead of a raw IP address, bots can continue to be controlled even if the C2 server is compromised. If an IP address is compromised, the associated C2 DNS record can be changed on the spot. DNS also supports various means of traffic encryption, enabling botnet owners to communicate via encrypted messages between bots through DNS over TLS or HTTPS, making packet analysis and traffic monitoring significantly more challenging. 

Following the public release of the Mirai botnet source code in 2016, \citet{Antonakakis2017} propose that the code's availability will spark a new generation of Mirai-based botnet variants, marking a significant point in the evolutionary scale of botnet history. Hajime, a recent variant of Mirai, is evidence of such evolution. The Hajime IoT botnet has adopted a de-centralised botnet communication strategy through Peer-to-Peer networking protocols. This strategy eliminates the need for a centralised C2 server, as peer-to-peer botnets can send, receive and exchange commands or files between each other. As there is no central point of communication, the 'serverless nature of P2P botnets makes identification and mitigation significantly more challenging than centralised botnet infrastructures. \citet{Herwig2019} found that the Hajime botnet utilises a Distributed Hash Table (DHT) overlay network available through the BitTorrent P2P protocol. Using a DHT overlay network allows for the distribution of software updates and attack commands across all connected nodes within a given P2P botnet network. Once a device is infected with the Hajime payload, it will join a DHT through a known peer and download content or receive commands from connected peer nodes marked as 'seeders'. As the BitTorrent DHT network is publicly available and actively used by legitimate peers, bots often interact with legitimate peers to introduce noise during any potential network analysis. A significant characteristic of the Hajime botnet, unlike that of centralised botnets, is that infected bots are used to self-propagate by individually downloading, hosting, and attacking other IoT devices using Hajime malware binaries exclusive to the architecture of the bot.

Despite the Hajime Peer-to-Peer botnet's game-changing feature-set, experts have observed a recent influx in de-centralised botnet traffic from a new Mirai botnet variant known as Mozi. \citep{Netlab2019} In the same way as Hajime, Mozi utilises a de-centralised Peer-to-Peer structure using Distributed Hash Tables. However, the Mozi botnet uses its own DHT protocol for propagation, utilising various public nodes from popular P2P services as bootstraps for guiding infected bots to the botnet DHT. These nodes are specified in a config file downloaded following successful infection through telnet brute-forcing and command-line injection. Similarly to Hajime, the Mozi botnet employs a unique strategy for botnet propagation where infected devices actively self-host malware binaries. Once infected, the bot will download Mozi malware binaries and DHT configuration files and deploy an HTTP server assigned to a randomly selected port. The bot will attempt to infect other devices using the malware hosted on a local HTTP server, alleviating the need for payload or loader servers commonly used by Mirai botnets. The HTTP server's port number changes over time, ensuring binaries are no longer retrievable from previously used ports after a given time frame. \citet{Netlab2019} observed that the Mozi botnet uses a specific identifier starting with \texttt{1:v4:} which is used to distinguish Mozi bots from legitimate P2P traffic. This identifier is followed by a flag consisting of 4 bytes. The first byte is randomly generated, the second is hard-coded in the Mozi config file, and the 3rd and 4th bytes are calculated using an algorithm found in Mozi's source code.


% =========================================================================================


\section{Defence against IoT Botnets}

As the rise of IoT vulnerabilities continues to increase, \citet{Bertino2017} argue that IoT botnet research must remain a high priority amongst cyber-security specialists. The propagation and utilisation of such botnets have proven to pose drastic effects on even the most secured internet services. \citet{Bertino2017} state that there are eight categories of vulnerabilities common to IoT devices that need to be resolved to mitigate attacks coordinated by malicious actors using IoT botnet malware. This list includes several vulnerabilities explicitly targeted by the Mirai botnet: the use of insecure web interfaces and control panels, known default login credentials, vulnerable web services, and insecure operating systems or firmware. However, even the most secure devices are likely to be infected with malware. Thus, the authors argue that the monitoring of network traffic and device behaviour should remain a central concern for mitigating botnet activity. By analysing network anomalies via Network Behavioural Analysis (NBA), potential botnet activity can be investigated and countered accordingly. It is suggested that various metrics need to be used to identify such anomalies, including the monitoring network bandwidth and protocol usage.

Reactive detection systems are often used to identify botnet perpetrators. However, such methods rely heavily on data collected after attacks have taken place. \citet{Lividas2006} proposes a solution for preemptive botnet identification allowing for botnet networks to be identified before attacks occur. Using various machine learning classifiers, it is suggested that botnet traffic can be through the real-time monitoring of IRC traffic using network flow analysis. However, modern communication protocols, including Peer-to-Peer and Hypertext Transfer Protocol (HTTP) protocols, have since replaced the IRC protocol within botnets. As it is challenging to keep up with the constantly evolving use of communication protocols amongst botnets, \citet{Moon2012} propose botnet traffic detection through the purposeful execution and dynamic/network analysis of malware binaries using an advanced honeypot system. Integrated with the back-end infrastructure of KORNET, the largest ISP service in Korea, this system showed a prediction accuracy of approximately 40\% for future blacklisted botnet traffic. Despite the valuable information obtained through static and dynamic analysis of malware binaries, this system's resulting low accuracy is likely due to un-optimal malware sample extraction from trivial data sources.

Despite conventional honeypots showing some success in the findings presented by \citet{Moon2012}, it is suggested by \citet{Malwaremustdie2016} that typical honeypot infrastructures ineffective in detecting IoT botnet activity. Botnets such as Mirai, Bashlite, Hajime and Mozi often target devices based on specific embedded CPU architectures and exposed ports. \citet{Antonakakis2017} propose that IoT botnet activity can be captured by configuring honeypots to mimic vulnerable IoT device characteristics by configuring servers to use vulnerable BusyBox software suites which respond to incoming requests with IoT-like headers. This method proved effective, logging connection attempts from over 80,000 foreign IP addresses over approximately five months and collecting a total of 151 unique malware binaries. Combining this honeypot information with various other sources, \citet{Antonakakis2017} identified different trends common to Mirai botnets, including several infection strategies, commonly targeted ports, and an analysis of high profile attacks. The study also investigates geographic patterns using the MaxMind GeoIP 2 database for collecting IP address geolocation information. This information provides an insight into the geographic distribution and density of IoT botnets. 

\citet{PaPa2016} similarly noted that non-IoT honeypot systems yielded insignificant results when collecting IoT botnet information, and thus proposed \textit{IoTPOT}, an improved IoT honeypot system with sandbox integration. By imitating various IoT devices, the proposed honeypot system uses specially configured servers that mimic targeted IoT devices. Each honeypot instance is integrated with an embedded system sandboxing environment. Once an intrusion is detected, all incoming and outgoing network traffic is monitored and downloaded malware samples are collected. This method proved significantly more effective than existing honeypot systems, such as Honeyd \citep{Honeyd2008}, as the virtual sandboxes could be expanded to support various IoT architectures ARM, MIPS, and PPC.

IoTPOT logs all telnet-based intrusion attempts made by visiting IP addresses and actively redirects all port-scanning activity to a dummy server, enabling the monitoring and observation of botnet propagation activity. However, this implementation yields a potential risk of honeypot instances becoming infected after successful intrusion attempts, resulting in unpredictable botnet activity. In such cases, the sandbox environments had to be completely reset to ensure all botnet activity is contained within the honeypot network. Some preventive measures were put in place to attenuate the potential side effects of infected hosts. For example, all outgoing Denial of Service (DoS) traffic is actively blocked, and all other traffic is rate-limited by the host network.

\citet{Bastos2019} build upon the concept of preemptive botnet detection through purposeful execution of malware binaries by collecting samples via 47 low-interactivity honeypot servers distributed across 15 Brazilian states. Similarly to \citet{Moon2012}, this implementation infers candidate C2 servers of Bashlite and Mirai botnets using four heuristics based on a combination of static and dynamic analysis techniques. Such heuristics include analysing hard-coded IP addresses in binary strings, contacted DNS names, payload server URLs, and port-specific connections uncommon to the scanning process. Once identified, candidate C2 servers are validated by executing variant-specific handshake procedures between botnets and infected hosts within the IoT sandboxing environment \textit{Detux Sandbox} \citep{Detux2016}. This environment supports binaries compiled to run on common IoT device architectures, including ARM, MIPS and x86. Binaries are executed for only 90 seconds, and common scanning ports such as the telnet ports 23 and 2323 were blocked to prevent significantly malicious activity from occurring during analysis. This system successfully identified and validated C2 servers for 62\% of binaries. \citet{Ceron2019} further builds upon this framework by focusing on improving upon the shortcomings of the previously proposed network analysis procedure. It is noted that blocking specific ports could lead to valuable network traffic from being blocked, assuming that some C2 servers communicate over commonly used ports such as 23 or 2323. Alternatively, \citet{Ceron2019} suggest using an adaptive network layer, similar to that of the strategies employed by \citet{PaPa2016}, that monitors, redirects and drops malicious packets. Redirecting packets through a Software Defined Network (SDN) ensures that no traffic data is lost when blocking ports. Following a successful handshake with a C2 server, all outgoing traffic is redirected to an impersonator C2 server for behavioural analysis.

\citet{Dwyer2019} propose a DNS-based botnet analysis framework using machine learning techniques. A distributed honeypot system spanning across the United States, Russia, and Brazil, was used to collect over 800,000 Mirai-like probes over approximately two years. The honeypot can automatically detect Mirai-like activity by analysing the TCP sequence of an incoming packet and checking for a Mirai-like fingerprint. If a packet contains a TCP sequence that matches the targeted device's IP address, the packet is deemed to be 'Mirai-like'. Approximately 25\% of collected packets were successfully reverse-queried, generating a comprehensive data-set of DNS records used for analysis. These DNS records are compared against a set of legitimate DNS records obtained from the Majestic Million Rankings list. A total of 6 features were extracted from each DNS record, including the Time To Live of the DNS record, the diversity of Autonomous Systems across all IP addresses associated with a DNS record, the Spatial distribution of IP addresses, the vowel density the domain name, and the Shannon entropy (randomness) of the domain name. Dwyer et al. found that the vowel density and Sharron entropy features gave the best results, yielding a detection rate of over 99\% accuracy with the Random Forest classification model.

A significant issue with the previously discussed detection frameworks is that they only effectively identify centralised botnets. To identify de-centralised Peer-to-Peer IoT botnets, \citet{Wang2017} propose a model for preemptively identifying botnet propagation through detecting malicious data streams amongst legitimate P2P traffic. The proposed detection procedure involves filtering out legitimate/benign Peer-to-Peer traffic through packet-based characteristic analysis. All remaining traffic is monitored using traffic flow analysis techniques which indicate botnet-like activity amongst peer-to-peer nodes. \citet{Li2019} further builds upon the concept of data-flow analysis for P2P botnet detection by proposing a detection system using distributed intelligence sharing. Potentially malicious P2P traffic is collected from distributed communal clusters. Upon receiving network traffic flows of possible P2P botnet communication, the flows are analysed using an algorithm based on the hidden Markov model to determine whether the traffic is benign or malicious.

Contrastingly, \citet{Herwig2019} devised a Peer-to-Peer botnet detection system for detecting Hajime botnets using a honeypot detection framework similar to centralised detection methods previously discussed. \citep{Bastos2019, Ceron2019} By performing handshakes with identified Peer-to-Peer nodes and joining Distributed Hash Tables, botnet traffic, propagation, and attack patterns can be monitored effectively. Once an authenticated handshake is established, Herwig et al. was able to gain access to internal DHT tables used by various Hajime botnets and were able to log a total of over 10 million unique public keys (bots) throughout the investigation period. As this framework is designed to exclusively target Hajime botnets, the handshake procedure, DHT activity, and attack patterns observed are exclusive to the Hajime botnet. Thus, the proposed strategy cannot be easily applied to other P2P IoT botnets which operate differently, such as Mozi. \citet{Netlab2019} identified that the Mozi botnet uses its own Distributed Hash Table protocol and has an extensive signature validation process strictly enforced between all botnet nodes. If a Mozi botnet node cannot validate another node's signature, the offending node is excluded from the botnet as a precautionary measure. Access to the Mozi botnet DHT can likely be achieved using methods similar to that of \citet{Herwig2019}. By mimicking a Mozi P2P node and successfully executing a handshake, the connected node can monitor all network traffic and connections to the DHT.